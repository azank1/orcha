{
  "description": "Order acceptance request",
  "type": "object",
  "allOf": [
    {
      "additionalProperties": false,
      "description": "Request metadata",
      "type": "object",
      "properties": {
        "request_id": {
          "minLength": 1,
          "description": "Optional request tracking ID",
          "type": "string"
        },
        "idem": {
          "minLength": 8,
          "maxLength": 64,
          "description": "Idempotency key for duplicate prevention",
          "type": "string"
        }
      }
    },
    {
      "additionalProperties": false,
      "type": "object",
      "properties": {
        "store_id": {
          "minLength": 1,
          "description": "Target store identifier",
          "type": "string"
        },
        "draft": {
          "additionalProperties": false,
          "description": "Order draft with calculated pricing",
          "type": "object",
          "properties": {
            "items": {
              "minItems": 1,
              "description": "Order line items",
              "type": "array",
              "items": {
                "additionalProperties": false,
                "description": "Order line item",
                "type": "object",
                "properties": {
                  "sku": {
                    "minLength": 1,
                    "description": "Product SKU identifier",
                    "type": "string"
                  },
                  "qty": {
                    "minimum": 1,
                    "description": "Quantity of items",
                    "type": "integer"
                  },
                  "note": {
                    "maxLength": 500,
                    "description": "Optional item notes or modifications",
                    "type": "string"
                  }
                },
                "required": [
                  "sku",
                  "qty"
                ]
              }
            },
            "subtotal": {
              "additionalProperties": false,
              "description": "Monetary value with currency",
              "type": "object",
              "properties": {
                "currency": {
                  "minLength": 3,
                  "maxLength": 3,
                  "pattern": "^[A-Z]{3}$",
                  "description": "ISO 4217 currency code (e.g., USD, EUR)",
                  "type": "string"
                },
                "amount": {
                  "minimum": 0,
                  "description": "Amount in the smallest currency unit (e.g., cents)",
                  "type": "number"
                }
              },
              "required": [
                "currency",
                "amount"
              ]
            },
            "taxes": {
              "description": "Tax breakdown",
              "type": "array",
              "items": {
                "additionalProperties": false,
                "description": "Monetary value with currency",
                "type": "object",
                "properties": {
                  "currency": {
                    "minLength": 3,
                    "maxLength": 3,
                    "pattern": "^[A-Z]{3}$",
                    "description": "ISO 4217 currency code (e.g., USD, EUR)",
                    "type": "string"
                  },
                  "amount": {
                    "minimum": 0,
                    "description": "Amount in the smallest currency unit (e.g., cents)",
                    "type": "number"
                  }
                },
                "required": [
                  "currency",
                  "amount"
                ]
              }
            },
            "fees": {
              "description": "Additional fees (delivery, service, etc.)",
              "type": "array",
              "items": {
                "additionalProperties": false,
                "description": "Monetary value with currency",
                "type": "object",
                "properties": {
                  "currency": {
                    "minLength": 3,
                    "maxLength": 3,
                    "pattern": "^[A-Z]{3}$",
                    "description": "ISO 4217 currency code (e.g., USD, EUR)",
                    "type": "string"
                  },
                  "amount": {
                    "minimum": 0,
                    "description": "Amount in the smallest currency unit (e.g., cents)",
                    "type": "number"
                  }
                },
                "required": [
                  "currency",
                  "amount"
                ]
              }
            },
            "total": {
              "additionalProperties": false,
              "description": "Monetary value with currency",
              "type": "object",
              "properties": {
                "currency": {
                  "minLength": 3,
                  "maxLength": 3,
                  "pattern": "^[A-Z]{3}$",
                  "description": "ISO 4217 currency code (e.g., USD, EUR)",
                  "type": "string"
                },
                "amount": {
                  "minimum": 0,
                  "description": "Amount in the smallest currency unit (e.g., cents)",
                  "type": "number"
                }
              },
              "required": [
                "currency",
                "amount"
              ]
            },
            "promos": {
              "description": "Applied promotion codes",
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          },
          "required": [
            "items",
            "subtotal",
            "taxes",
            "fees",
            "total"
          ]
        }
      },
      "required": [
        "store_id",
        "draft"
      ]
    }
  ]
}