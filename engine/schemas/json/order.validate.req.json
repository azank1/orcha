{
  "description": "Order validation request",
  "type": "object",
  "allOf": [
    {
      "additionalProperties": false,
      "description": "Request metadata",
      "type": "object",
      "properties": {
        "request_id": {
          "minLength": 1,
          "description": "Optional request tracking ID",
          "type": "string"
        },
        "idem": {
          "minLength": 8,
          "maxLength": 64,
          "description": "Idempotency key for duplicate prevention",
          "type": "string"
        }
      }
    },
    {
      "additionalProperties": false,
      "type": "object",
      "properties": {
        "store_id": {
          "minLength": 1,
          "description": "Target store identifier",
          "type": "string"
        },
        "items": {
          "minItems": 1,
          "description": "Order items to validate",
          "type": "array",
          "items": {
            "additionalProperties": false,
            "description": "Order line item",
            "type": "object",
            "properties": {
              "sku": {
                "minLength": 1,
                "description": "Product SKU identifier",
                "type": "string"
              },
              "qty": {
                "minimum": 1,
                "description": "Quantity of items",
                "type": "integer"
              },
              "note": {
                "maxLength": 500,
                "description": "Optional item notes or modifications",
                "type": "string"
              }
            },
            "required": [
              "sku",
              "qty"
            ]
          }
        },
        "customer": {
          "additionalProperties": false,
          "description": "Customer information",
          "type": "object",
          "properties": {
            "mode": {
              "description": "Order fulfillment mode",
              "anyOf": [
                {
                  "const": "PICKUP",
                  "type": "string"
                },
                {
                  "const": "DELIVERY",
                  "type": "string"
                }
              ]
            },
            "name": {
              "minLength": 1,
              "maxLength": 100,
              "description": "Customer name",
              "type": "string"
            },
            "phone": {
              "pattern": "^\\+?[1-9]\\d{1,14}$",
              "description": "Customer phone number (E.164 format)",
              "type": "string"
            },
            "address": {
              "maxLength": 500,
              "description": "Delivery address (required for DELIVERY mode)",
              "type": "string"
            }
          },
          "required": [
            "mode"
          ]
        },
        "payment": {
          "additionalProperties": false,
          "description": "Payment method hint",
          "type": "object",
          "properties": {
            "method": {
              "description": "Intended payment method",
              "anyOf": [
                {
                  "const": "CARD",
                  "type": "string"
                },
                {
                  "const": "CASH",
                  "type": "string"
                },
                {
                  "const": "NONE",
                  "type": "string"
                }
              ]
            }
          },
          "required": [
            "method"
          ]
        }
      },
      "required": [
        "store_id",
        "items",
        "customer"
      ]
    }
  ]
}